---
import { Code } from "astro:components";
import { format, type Options } from "prettier";
import { transformerTwoslash } from "@shikijs/twoslash";

export const THEME = "poimandres";

const PRETTIER_OPTIONS = {
  parser: "typescript",
} as const satisfies Options;

type Props = {
  readonly code: string;
  twoslash?: boolean;
};

const { code, twoslash = false } = Astro.props;

const formattedCode = await format(
  twoslash
    ? `
      import * as R from "remeda";
      // ---cut---
      ${code}
    `
    : code,
  PRETTIER_OPTIONS,
);
---

<style is:global>
  .astro-code {
    @apply rounded px-4 py-2;
  }
</style>

<Code
  code={formattedCode}
  lang="typescript"
  theme={THEME}
  transformers={twoslash
    ? [
        transformerTwoslash({
          twoslashOptions: {
            handbookOptions: {
              noErrorValidation: true,
            },
          },
        }),
      ]
    : []}
  wrap
/>
